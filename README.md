# PHPJasperXML - Laravel
Library for parsing jrxml files generated by ireport designer and outputting them to the browser as PDFs.
> Note: This code is only tested with Laravel 4 and altered solely for use with Mysql.

### About
This project is based on the original PHPJasperXML library, just fixed some bugs, changed some stuff that I needed and wanted to share them.

A list of some of the changes:
  - Use of Laravel's database.php config file as the source of database configuration.
  - Use of laravel DB class to execute report's SQL (Mysql only) .
  - Subreports now render.
  - Fixed arabic words not displaying.

As this project and its parent are in early development status, there are still bugs and non-working functionality, but you can work you way around most of that.

### Usage
Create a directory named "includes" inside your app directory that will contain two subdirectories, "class", that's the library itself, and "reports", that will contain our reports and images (This path is hardcoded in the library as I'll point that out down below and show where to change it) .

That is the directory structure assumed for use with the library, showing only what matters, other is standard laravel directory structure.
  
```
project
└───app
    ├───Controllers
    │   │   BaseController.php
    │   │   ReportController.php
    └───includes
    │   └───class
    │   └───reports
    │   │   │   testreport.jrxml
    │   │   │   testimage.png
```
here's what you'll need to do then


    1. Design your report in ireport designer and place the .jrxml file (and the subreports and images it contains, if any) in your app/includes/reports directory, lets say you gave it the name "testreport.jrxml".
    2. Create a new controller (I choose to name it "ReportController"), That's what will be inside
```
<?php
include_once(app_path().'/includes/class/tcpdf/tcpdf.php');
include_once(app_path()."/includes/class/PHPJasperXML.inc.php");

class ReportController extends BaseController {

	public function anyViewreport($report='')
	{
                if ($report == 'testreport') {
                    $param1 = Input::get('param1');

                    $PHPJasperXML = new PHPJasperXML();

                    //Enabling this will let you see the generated SQL (with parameters in place and all)
                    //$PHPJasperXML->debugsql=true; 

                    //Array of parameters eg. array("param1"  => $param1, "param2"=>$param2);
                    //Here we assume that the report has a parameter called "param1"
                    $PHPJasperXML->arrayParameter=array("param1"  => $param1);
                    }

                $PHPJasperXML->load_xml_file(app_path()."/includes/reports/".$report.".jrxml");
        
                $PHPJasperXML->transferDBtoArray();
                //Clean the end of the buffer before outputting the PDF
                ob_end_clean();

                //page output method I:standard output  D:Download file
                return Response::make($PHPJasperXML->outpage("I"));
	}

}

```
So now we have the controller including the necessary files to display the report, asking for its name to give it its parameters and displaying it on the browser.
   3. Add the route to your routes.php file.
```
Route::controller('reports', 'ReportController');
```
   4. Now type the URL to display the report sending it the parameter as a GET
```
http://serverurl/reports/viewreport/testreport?param1=test
```
Now you should see your report.

>Note: when using images, enter only their name and extension in the "Image Expression" property in ireport designer, the library looks for that inside app/includes/reports by default, that was implemented to avoid full paths problems (next section points out how to change that).

#### Where the hardcoded path is located
I know it's kinda silly to hardcode the path even if it's still a relative path, but I didn't have time to refactor that, if you fixed it for yourself please share it with us.

Here is the list of where the "/includes" directory is forced:
  - the includes in the beginning of the ReportController.
  - *load_xml_file* function call in the ReportController.
  - Line 3920 in PHPJasperXML.inc.php file (Used for locating images), search for 
  ```$path = app_path()."/includes/reports/".$path;```
  - Line 4940 in *PHPJasperXML.inc.php* file, search for 
   ``` app_path()."/includes/reports/".$d['subreportExpression']```
